# Challenge Api

<p>Api desenvolvida usando .net core com o objetivo de cadastrar usuarios e seus produtos favoritos.</p>

## Instalação
<p>Para testar a solução basta rodar o comando no prompt de comando para o docker compose utilizando o arquivo compose que esta na pasta src.</p>

```bash
docker-compose up -d --build
```

## Utilização

<p>Com o docker rodando acesse a [url](http://localhost:8081/swagger/) que exibirá a documentação swagger da solução.</p>
<p>Os endpoints de Customer, Products e FavoriteProduct estão protegidos com autenticação JWT Bearer. </p>
<p>Então o primeiro passo e criar usuário de acesso a api utilizando o endpoint /api/Token/CreateUser </p>
<p>Com os dados corretos para criar usuario ele retornará um token de acesso para habilitar demais endpoints. </p>
<p>Para isso no swagger clicar no botão Authorize e informar o Token gerado no passo anterior utilizando o Bearer + "Token" </p>

<p>O Token tem validade de 2 horas, após isso poderá acessar o endpoint /api/Token/Authenticate para gerar um novo token para usuario ja cadastrado.</p>
<p>Com usuário autenticado no sistema, então será permitido criar um novo cliente passando os dados básicos.</p>
<p>Para favoritar um produto para um cliente, então será necessário listar os produtos e informar o id do produto mais o id do cliente.</p>

## Tecnologias e Bibliotecas utilizadas
<p>- .Net Core 8</p>
<p>- Postgresql</p>
<p>- Optional para facilitar teste condicional</p>
<p>- Identity para criptografar senha</p>
<p>- Swagger para documentação</p>
<p>- Entity Framework para criar consultas ao banco</p>
<p>- JWTbearer para autenticação de acesso a api</p>
<p>- HttpClient para acessar endpoint de produtos externa</p>
 
## Script da migração de dados gerada
```bash
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);

START TRANSACTION;

CREATE TABLE "Customer" (
    "Id" bigint GENERATED BY DEFAULT AS IDENTITY,
    "Name" character varying(120) NOT NULL,
    "Email" character varying(200) NOT NULL,
    CONSTRAINT "PK_Customer" PRIMARY KEY ("Id")
);

CREATE TABLE "Product" (
    "Id" bigint GENERATED BY DEFAULT AS IDENTITY,
    "Title" character varying(300) NOT NULL,
    "Image" text,
    "Review" character varying(3000),
    "Price" numeric NOT NULL,
    CONSTRAINT "PK_Product" PRIMARY KEY ("Id")
);

CREATE TABLE "FavoriteProduct" (
    "ProductId" bigint NOT NULL,
    "CustomerId" bigint NOT NULL,
    "Id" bigint NOT NULL,
    CONSTRAINT "PK_FavoriteProduct" PRIMARY KEY ("CustomerId", "ProductId"),
    CONSTRAINT "FK_FavoriteProduct_Customer_CustomerId" FOREIGN KEY ("CustomerId") REFERENCES "Customer" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_FavoriteProduct_Product_ProductId" FOREIGN KEY ("ProductId") REFERENCES "Product" ("Id") ON DELETE CASCADE
);

CREATE UNIQUE INDEX "IX_Customer_Email" ON "Customer" ("Email");

CREATE INDEX "IX_FavoriteProduct_ProductId" ON "FavoriteProduct" ("ProductId");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250509192216_Initial', '8.0.15');

COMMIT;

START TRANSACTION;

CREATE TABLE "User" (
    "Id" bigint GENERATED BY DEFAULT AS IDENTITY,
    "Email" text NOT NULL,
    "Password" text NOT NULL,
    CONSTRAINT "PK_User" PRIMARY KEY ("Id")
);

CREATE UNIQUE INDEX "IX_User_Email" ON "User" ("Email");

INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250512005127_AddTableUser', '8.0.15');

COMMIT;
```
